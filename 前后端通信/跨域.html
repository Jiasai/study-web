<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>跨域</title>
	</head>
	<body>
		

<script type="text/javascript">
	
  /* 跨域是什么
 
 //这是同域,而不是跨域
const URL = './JSON/arr.json'; //通信地址（接口）
 
//这是不同域，跨域，被浏览器阻止
 const URL = 'https://www.imooc.com'; 
 
 向一个域发送请求，如果要请求的域和当前域是不同域，就叫跨域；
不同域之间的请求，就是跨域请求；
 
  什么是不同域,什么是同域  
  "https(协议)://www.imooc.com(域名):443(端口号)/course/list(路径)"
 
 协议、域名、端口号,任何一个不一样,就是不同域
 与路径无关,路径相不相同无所谓
 https端口号 443,http端口号 80
  
  
  跨域请求为什么会被阻止
  阻止跨域请求,其实是浏览器本身的一种安全策略-同源策略;
  
  其他客户端或者服务器都不存在跨域被阻止的问题,只有浏览器有
  
  跨域解决方案
  1. CORS跨域资源共享 (最常用的方案)
  2. JSONP (<script>标签,没有跨域阻止问题);
  
  优先使用 CORS跨域资源共享,如果浏览器不支持 CORS的话,再使用 JSONP

  CORS是什么？  
  //这是跨域请求地址
   const URL2 = 'https://www.imooc.com/api/http/search/suggest?words=js'; 
  
 // (上面的请求地址,后端设置了 下面这个字段,)
  Access-Control-Allow-Origin: * (响应头中)
  表明允许所有的域名来跨域请求它， * 是通配符，没有任何限制；
  
  只允许指定域名的跨域请求
 Access-Control-Allow-Origin: http://127.0.0.1:8848
  
  
  使用CORS跨域的过程？
  a.浏览器发送请求;
  b.后端在响应头中添加 Access-Control-Allow-Origin头信息
  c.浏览器接收到响应;
  d.如果是同域下的请求,浏览器不会额外做什么,这次前后端通信就圆满完成了
  
  e.如果是跨域请求,浏览器会从响应头中查找是否允许跨域访问,允许跨域,通信圆满完成;
  如果没找到或不包含想要跨域的域名,就丢弃响应结果;
  
  
  CORS的兼容性
  IE10及以上版本的浏览器可以正常使用 CORS
  
  https://caniuse.com
  
  JSONP原理:
  script标签跨域不会被浏览器阻止;
  JSONP主要就是利用script标签,加载跨域文件;
  
  2.使用JSONP实现跨域
  （开发沟通告诉）后端在服务器端准备好 JSONP接口
  https://www.imooc.com/api/http/jsonp?callback=handleResponse
  
  用<script>标签，手动加载 JSONP接口: */
 console.log(`这是JSONP接口：<script src="https://www.imooc.com/api/http/jsonp?callback=handleResponse"><\/script>`);
 // 但是一般不会手动添加，而是通过js动态创建加载的方式;
  const script = document.createElement('script');
  script.src = 'https://www.imooc.com/api/http/jsonp?callback=handleResponse';
  document.body.appendChild(script);
  
  //声明函数(函数名是接口地址中设置的 handleResponse)
  const handleResponse = data=>{
	  console.log(data);
  }
  
  
  //创建对象实例
  // const xhr = new XMLHttpRequest();
  
  // //添加事件监听
  // xhr.onreadystatechange=()=>{
  // 	if(xhr.readyState !== 4) return;
  // 	if((xhr.status>=200 && xhr.status < 300)||xhr.status ===304){
  // 	console.log(xhr.responseText);		
  // 	console.log(typeof xhr.responseText);
  
  // 	}
  // }
  
  // //准备
  // xhr.open('GET',URL2,true);
  
  // //发送
  // xhr.send(null); 
   
  
  
</script>	



</body>
</html>
